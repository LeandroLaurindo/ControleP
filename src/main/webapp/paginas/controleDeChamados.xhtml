<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./layoutPadrao.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="controleChama">
        <p:panel header="Controle Chamados">
            <f:view>
                <h:form>
                    <p:messages autoUpdate="true" closable="true" />
                </h:form>
            </f:view>
            <f:view>
                <h:form id="cadFrmCham">
                    <p:dialog widgetVar="dlgAtendimento" closable="true">
                        <p:fieldset legend="Criar/Editar">
                            <h:panelGrid columns="2">
                                <p:outputLabel value="Clientes:" for="clientesId" />
                                <p:selectOneMenu id="clientesId" value="#{controleChamados.cliente}" converter="ChamadosatendidosConverter" required="true" requiredMessage="O Clientes é obrigatório."
                                                 widgetVar="tipoforne2" filter="true" filterMatchMode="contains" panelStyle="width:400px" style="float: left">
                                    <!-- TODO: update below reference to list of available items-->
                                    <p:ajax  process="clientesId" event="change" listener="#{controleChamados.setartelefone()}"/>
                                    <f:selectItem itemLabel="Selecione" itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItems value="#{controleChamados.listaClientes}" var="cli" itemLabel="#{cli.nome}" itemValue="#{cli}"/>
                                </p:selectOneMenu>
                                <p:outputLabel value="Solicitante:" for="solicitante" />
                                <p:inputText id="solicitante" value="#{controleChamados.chamados.solicitante}" title="Solicitante" onkeyup="value = value.toUpperCase()" />
                                <p:outputLabel value="Telefone:" for="telefone" />
                                <p:inputText id="telefone" value="#{controleChamados.chamados.telefone}" title="Telefone" />
                            </h:panelGrid>
                            <h:panelGrid columns="1">
                                <p:outputLabel value="Descrição do servico:" for="descricaoservico" />
                                <p:editor id="descricaoservico" widgetVar="editorWidget" value="#{controleChamados.chamados.descricaoservico}" width="600" />
                                <p:commandButton value="Clear" type="button" onclick="PF('editorWidget').clear();" icon="ui-icon-closethick" />
                            </h:panelGrid>


                            <p:commandButton value="Salvar" styleClass="botao" icon="ui-icon-disk" actionListener="#{controleChamados.salvar()}" />
                            <p:commandButton value="Fechar" styleClass="botao" icon="ui-icon-cancel" onclick="PF('dlgAtendimento').hide()" process="@this" />
                        </p:fieldset>
                    </p:dialog>
                </h:form>
            </f:view>
            <f:view>
                <h:form id="formTbChamados">
                    <p:dataTable value="#{controleChamados.listaChamadosatendidos}" var="item" widgetVar="pausaTable2" paginator="true"
                                 emptyMessage="Nenhum usuário encontrado!" currentPageReportTemplate="(Pag. {currentPage}/{totalPages} - {totalRecords} registros)"
                                 rows="10" rowsPerPageTemplate="5,10,15,#{controleChamados.listaChamadosatendidos.size()}">
                        <f:facet name="header">
                            <p:selectOneMenu id="tipox" value="#{controleChamados.idCliente}" label="Pequisar por Cliente" widgetVar="tipoforne1" title="se todos desmarcados consulta todos."
                                             filter="true" filterMatchMode="contains" panelStyle="width:400px" style="float: left;">
                                <p:ajax  process="tipox" event="change" listener="#{controleChamados.listaConfiltros()}"/>
                                <f:selectItem itemLabel="Selecione" itemValue="" noSelectionOption="true" />
                                <f:selectItems value="#{controleChamados.listaClientes}" var="fnnox" itemValue="#{fnnox.id}"   itemLabel="#{fnnox.nome}" />
                            </p:selectOneMenu> 
                            <p:commandButton value="Novo Chamado" styleClass="botao"  actionListener="#{controleChamados.novoChamadosatendidos()}" icon="ui-icon-plus" style="float: right; margin-right: 20px;" oncomplete="PF('dlgAtendimento').show()"/>
                            <h3>Lista de Chamados</h3>
                        </f:facet>
                        <p:column filterBy="#{item.clientesId.nome}">
                            <f:facet name="header">
                                <h:outputText value="Cliente"/>
                            </f:facet>
                            <h:outputText value="#{item.clientesId.nome}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Solicitante"/>
                            </f:facet>
                            <h:outputText value="#{item.solicitante}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Telefone"/>
                            </f:facet>
                            <h:outputText value="#{item.telefone}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Descricaoservico"/>
                            </f:facet>
                            <p:commandButton value="Detalhes" styleClass="botao" actionListener="#{controleChamados.setarDescricao(item.descricaoservico)}" icon="ui-icon-check" oncomplete="PF('dlgDescricao').show()"  process="@this"/>

                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="DataInicio"/>
                            </f:facet>
                            <h:outputText value="#{item.dataInicio}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="DataFim"/>
                            </f:facet>
                            <h:outputText value="#{item.dataFim}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
                            </h:outputText>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="Ação" />
                            </f:facet>
                            <p:commandButton value="Finalizar"  styleClass="botao" actionListener="#{controleChamados.finalizar(item)}" icon="ui-icon-check"  process="@this" rendered="#{item.dataFim == null}"/>
                            <p:commandButton value="Editar" styleClass="botao" actionListener="#{controleChamados.setarChamadosatendidosEditar(item)}" icon="ui-icon-pencil" process="@this" oncomplete="PF('dlgAtendimento').show()"/>
                            <p:commandButton value="Excluir" styleClass="botao" actionListener="#{controleChamados.setarChamadosatendidosRemover(item)}" icon="ui-icon-trash" process="@this" oncomplete="PF('dlgConfirmarD').show()"/>
                        </p:column>
                    </p:dataTable>
                </h:form>
            </f:view>
            <f:view>
                <h:form id="frmDescricao">
                    <p:dialog widgetVar="dlgDescricao" closable="true" header="Descrição Atendimento" style="max-width: 80%;">
                        <h:outputText value="#{controleChamados.descricao}" escape="false"/>
                        <hr />
                        <p:commandButton value="Fechar" styleClass="botao" icon="ui-icon-close" onclick="PF('dlgDescricao').hide()" />
                    </p:dialog>
                </h:form>
            </f:view>
            <f:view>
                <h:form> 
                    <p:dialog header="Confirmação" closable="true" widgetVar="dlgConfirmarD">
                        <h:panelGrid columns="1">
                            <h:outputText value="Tem certeza que você deseja excluir este registro?" />
                            <h:panelGrid columns="2">
                                <p:commandButton value="SIM" styleClass="botao" actionListener="#{controleChamados.deletar()}" oncomplete="PF('dlgConfirmarD').hide()" icon="ui-icon-check" iconPos="true" />
                                <p:commandButton value="NÂO" styleClass="botao" onclick="PF('dlgConfirmarD').hide()" icon="ui-icon-cancel" iconPos="true" />
                            </h:panelGrid>
                        </h:panelGrid>
                    </p:dialog>
                </h:form>
            </f:view>
        </p:panel>
    </ui:define>

</ui:composition>
